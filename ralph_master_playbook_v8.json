{
  "protocol": {
    "name": "Ralph Master Playbook",
    "version": "8.0.0",
    "effective_date": "2026-02-17",
    "status": "ACTIVE",
    "purpose": "Mandatory, parallel, proof-based governance that runs in real time with all development. One-time full legacy baseline (user-triggered once per project) + permanent automatic delta enforcement on any changed legacy file.",
    "scope": "All five synced projects under surajsatyarthi/ralph-protocols",
    "non_retrospective_default": true,
    "retro_audit_enabled": true
  },
  "core_principles": [
    "Mandatory at Antigravity platform level (Rules + Skills + Terminal Policy)",
    "Parallel real-time verification via dedicated Ralph Verifier Agent",
    "Cryptographic HMAC proofs tied to commit SHA (fallback RALPH_HMAC_KEY)",
    "One-time full baseline retro-audit (triggered once per project) followed by permanent automatic delta-only mode for legacy files",
    "Forward-only for new code; automatic delta enforcement for any legacy change",
    "Defense-in-depth with no manual intervention after baseline"
  ],
  "enforcement_layers": {
    "antigravity": {
      "rules": "Global ~/.gemini/GEMINI.md + per-project .agent/rules/ralph-core.md",
      "skills": ".agent/skills/ralph-enforcer/ (one SKILL.md per gate)",
      "terminal_policy": "Request review for git, npm, db, shell; safe-exec wrapper",
      "verifier_agent": {
        "prompt": "You are Ralph Verifier v8.0. Monitor all file changes/diffs in real time. Run relevant gate Skills on every change. For legacy files: apply full gates only on changed files (delta mode) after one-time baseline is complete. Block main agent until HMAC-signed proof exists. Log to .ralph/audit.log.",
        "spawn": "Persistent, auto-start on project open",
        "retro_mode": "one_time_full_baseline + permanent_delta_automatic"
      }
    },
    "github": {
      "rulesets": "Protect main/develop/releases/**. Require 'Ralph-Gates-Passed' status check. Require signed commits.",
      "ci_workflow": ".github/workflows/ralph-verify.yml (parallel gates + proof upload)"
    }
  },
  "proof_system": {
    "method": "HMAC-SHA256",
    "key_source": "git rev-parse HEAD (fallback: RALPH_HMAC_KEY from .env)",
    "artifact_dir": ".ralph/proofs/",
    "legacy_dir": ".ralph/proofs/legacy/",
    "format": "{\"gate\":\"G0\",\"status\":\"passed\",\"data_hash\":\"...\",\"commit_sha\":\"...\",\"hmac\":\"...\",\"timestamp\":\"...\"}"
  },
  "retro_audit": {
    "strategy": "one_time_full_baseline + permanent_delta_automatic",
    "baseline_status": "pending_user_trigger_per_project",
    "trigger_command": "run retro-audit full baseline on [path]",
    "permanent_mode": "automatic_delta_on_any_legacy_change",
    "output": "LEGACY_AUDIT_BASELINE.md + per-file signed proofs + prioritized LEGACY_AUDIT_BACKLOG.md",
    "phases": ["pilot", "core", "supporting", "full"]
  },
  "gates": {
    "technical": [
      {"id": "G0", "name": "Pre-Assignment Dupe Blocker", "skill": "g0-pre-assign"},
      {"id": "G2", "name": "External Research Validation", "skill": "g2-research"},
      {"id": "G3", "name": "Scope Validation", "skill": "g3-scope"},
      {"id": "G5", "name": "Strict Lint Suppression", "skill": "g5-lint-strict"},
      {"id": "G6", "name": "Test Quality Analysis", "skill": "g6-test-quality"},
      {"id": "G7", "name": "Security Suite", "skill": "g7-security"},
      {"id": "G9", "name": "Accessibility Validation", "skill": "g9-accessibility"},
      {"id": "G10", "name": "Performance (Median Lighthouse ≥80)", "skill": "g10-performance"},
      {"id": "G12", "name": "Documentation Completeness", "skill": "g12-validate"}
    ],
    "pm_strategic": [
      {"id": "PM-G1", "name": "User Research Validation", "skill": "pm-g1-user-research"},
      {"id": "PM-G2", "name": "PRD Quality Validation", "skill": "pm-g2-prd"},
      {"id": "PM-G3", "name": "Technical Feasibility", "skill": "pm-g3-feasibility"},
      {"id": "PM-G6", "name": "Atomic Ledger Approval", "skill": "pm-g6-approve"}
    ]
  },
  "best_practices": {
    "defense_in_depth": true,
    "least_privilege_terminal": true,
    "automatic_delta_enforcement": "After per-project baseline, any legacy file change triggers full gates automatically",
    "one_time_baseline": "User triggers once per project; then fully automatic",
    "auditability": "All actions logged with cryptographic proofs"
  },
  "clarification_questions_resolved": [
    {"question": "Retro-analysis automatic or manual?", "answer": "One-time full baseline (triggered once per project) + permanent automatic delta on any legacy change"},
    {"question": "G10 baseline", "answer": "80 (practical threshold)"},
    {"question": "Terminal allowlist", "answer": "Restrictive with Request review"},
    {"question": "HMAC fallback", "answer": "RALPH_HMAC_KEY from .env"}
  ],
  "sync_mechanism": {
    "source": "Central GitHub repo surajsatyarthi/ralph-protocols",
    "command": "npm run sync:protocols (or sync:protocols:init)",
    "frequency": "Explicit user command or postinstall hook — NOT every project run",
    "action_on_sync": "Pull latest playbook JSON → place in .agent/ → trigger Antigravity ingestion → update Skills/Rules → spawn/update Verifier Agent → prepare for one-time baseline retro-audit"
  },
  "references": [
    "https://codelabs.developers.google.com/getting-started-with-antigravity-skills",
    "https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-rulesets/about-rulesets",
    "https://www.knostic.ai/blog/ai-coding-agent-security",
    "https://www.techtarget.com/searchsoftwarequality/tip/Guidelines-for-AI-driven-legacy-code-modernization"
  ]
}
